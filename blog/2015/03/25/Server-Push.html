<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="" name="description"> <meta content="Stuart Douglas" name="author"> <title>Using Server Push with Undertow Â· JBoss Community</title> <link href="https://static.jboss.org/theme/css/bootstrap-community/2.3.1.1/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link href="https://undertow.io/stylesheets/code.css" rel="stylesheet" type="text/css"> <script src="https://undertow.io/javascripts/highlight.pack.js" type="text/javascript"></script> <script type="text/javascript">hljs.initHighlightingOnLoad();</script> <!--[if lt IE 9]><script src="https://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--> <link href="https://undertow.io/images/undertow_icon_16px.png" rel="shortcut icon"> <link href="https://static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="https://static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="https://static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="https://static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <style>
  @media (min-width: 651px) {
      .banner { background-image: url(https://undertow.io/images/undertow_banner.png); height: 110px;  }
  }
  @media (max-width: 650px) {
      .banner { width: 200px; margin: 0px auto; }
  }
</style> <script src="https://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> </head> <body> <div class="container" id="content"> <div class="dropup"> <a class="tabnav-closed" href="https://www.redhat.com" id="tab">Red Hat</a> </div> <div class="banner"> </div> <div class="navbar navbar-inverse" id="navbar-fix"> <div class="navbar-inner"> <div class="container"> <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <div class="nav-collapse collapse"> <ul class="nav"> <li class=""><a href="https://undertow.io/index.html">Home</a></li> <li class="active"><a href="https://undertow.io/blog/index.html">Blog</a></li> <li class=""><a href="https://undertow.io/downloads.html">Download</a></li> <li class=""><a href="https://undertow.io/documentation.html">Documentation</a></li> <li class=""><a href="https://undertow.io/get-involved.html">Get Involved</a></li> <li class="divider"></li> </ul> </div> </div> </div> </div> <h2 class="title">Using Server Push with Undertow</h2> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>The Undertow 1.2 branch supports both HTTP2 and SPDY, both of which support the concept of server push. If you are unfamiliar with server push this basically gives the server the ability to push resources cachable resources to a client before a client has requested them. For example if a client requests a HTML page and the server knows this page contains an image, the server could push the image to the client immediately, rather than waiting for the client to receive the page, parse the HTML and then send the request.</p> </div> </div> </div> <div class="sect1"> <h2 id="_caveats">Caveats</h2> <div class="sectionbody"> <div class="paragraph"> <p>Before I go into detail about how to use push, there are some pitfalls that you should be aware of. First you can only push resources that are allowed to be cached (think of pushed responses as pre-loading the browser cache).</p> </div> <div class="paragraph"> <p>You should also be aware that in general there is no reliable way to know if a browser already has a resource cached. If you push a resource that a browser has cached this is not a big deal, as the browser will just reset the stream, however it does waste some bandwidth and other server resources.</p> </div> <div class="paragraph"> <p>It is also important to note that if SPDY is in use then it is not possible to set the request headers that correspond to the pushed response, instead the relevant request headers from the current request are assumed by the browser.</p> </div> <div class="paragraph"> <p>Pushing is only allowed when a request is in progress, as all pushed responses correspond to an existing browser initiated request (you cannot do websocket style full duplex communication, at least not without some kind of long polling style hack).</p> </div> </div> </div> <div class="sect1"> <h2 id="_the_api">The API</h2> <div class="sectionbody"> <div class="paragraph"> <p>At the moment the API is experimental and somewhat subject to change. At the moment there is no standard API for server push (this is coming in Servlet 4.0), so it is necessary to use Undertow&#8217;s native API.</p> </div> <div class="paragraph"> <p>The Undertow API to support push is provided by the ServerConnection object, which can be obtained by calling <code>HttpServerExchange.getConnection()</code> (if you are using the Servlet API and don&#8217;t have access to the exchange you can get it by calling <code>io.undertow.servlet.handlers.ServletRequestContext.requireCurrent().getExchange()</code>.</p> </div> <div class="paragraph"> <p>The API is as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    /**&#x000A;     * Attempts to push a resource if this connection supports server push. Otherwise the request is ignored.&#x000A;     *&#x000A;     * Note that push is always done on a best effort basis, even if this method returns true it is possible that&#x000A;     * the remote endpoint will reset the stream.&#x000A;     *&#x000A;     * @param path The path of the resource&#x000A;     * @param method The request method&#x000A;     * @param requestHeaders The request headers&#x000A;     * @return &lt;code&gt;true&lt;/code&gt; if the server attempted the push, false otherwise&#x000A;     */&#x000A;    public boolean pushResource(final String path, final HttpString method, final HeaderMap requestHeaders);&#x000A;&#x000A;    /**&#x000A;     * Attempts to push a resource if this connection supports server push. Otherwise the request is ignored.&#x000A;     *&#x000A;     * Note that push is always done on a best effort basis, even if this method returns true it is possible that&#x000A;     * the remote endpoint will reset the stream.&#x000A;     *&#x000A;     * The {@link io.undertow.server.HttpHandler} passed in will be used to generate the pushed response.&#x000A;     *&#x000A;     * @param path The path of the resource&#x000A;     * @param method The request method&#x000A;     * @param requestHeaders The request headers&#x000A;     * @return &lt;code&gt;true&lt;/code&gt; if the server attempted the push, false otherwise&#x000A;     */&#x000A;    public boolean pushResource(final String path, final HttpString method, final HeaderMap requestHeaders, HttpHandler handler);&#x000A;&#x000A;    /**&#x000A;     * Returns true if push is supported&#x000A;     *&#x000A;     * @return &lt;code&gt;true&lt;/code&gt; if push is supported on this connection&#x000A;     */&#x000A;    public boolean isPushSupported() {&#x000A;        return false;&#x000A;    }</code></pre> </div> </div> <div class="paragraph"> <p>For the most part the API is fairly self explanatory, <code>isPushSupported()</code> can be used to determine if the connection supports push, and <code>pushResource()</code> is used to push the specified resource. Note that as specified above the <code>requestHeaders</code> parameter is ignored if SPDY is in use, it is only applicable for HTTP2.</p> </div> </div> </div> <div class="sect1"> <h2 id="_the_learning_push_handler">The Learning Push Handler</h2> <div class="sectionbody"> <div class="paragraph"> <p>Undertow provides a built in handler that provides some out of the box server push functionality. This handler is the <code>io.undertow.server.handlers.LearningPushHandler</code>. If you include this in your handler chain it will attempt to learn which resources browsers request soon after requesting specific pages, and uses this knowledge to initiate a server push.</p> </div> <div class="paragraph"> <p>This works by examining the referrer header on requests, and using a heuristic to decide which resources are a candidate to be pushed.</p> </div> </div> </div> <div id="companyfooter-placeholder"></div> </div> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="https://www.redhat.com/"><img src="https://static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <script src="https://static.jboss.org/wildfly/scripts/bootstrap-community.min.js"></script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61374382-1', 'auto');
  ga('send', 'pageview');
</script> </body> </html>