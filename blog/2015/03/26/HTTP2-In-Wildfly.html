<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="" name="description"> <meta content="Stuart Douglas" name="author"> <title>Using HTTP2 With Wildfly 9.0.0.Beta1 Â· JBoss Community</title> <link href="https://static.jboss.org/theme/css/bootstrap-community/2.3.1.1/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link href="https://undertow.io/stylesheets/code.css" rel="stylesheet" type="text/css"> <script src="https://undertow.io/javascripts/highlight.pack.js" type="text/javascript"></script> <script type="text/javascript">hljs.initHighlightingOnLoad();</script> <!--[if lt IE 9]><script src="https://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--> <link href="https://undertow.io/images/undertow_icon_16px.png" rel="shortcut icon"> <link href="https://static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="https://static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="https://static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="https://static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <style>
  @media (min-width: 651px) {
      .banner { background-image: url(https://undertow.io/images/undertow_banner.png); height: 110px;  }
  }
  @media (max-width: 650px) {
      .banner { width: 200px; margin: 0px auto; }
  }
</style> <script src="https://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> </head> <body> <div class="container" id="content"> <div class="dropup"> <a class="tabnav-closed" href="https://www.redhat.com" id="tab">Red Hat</a> </div> <div class="banner"> </div> <div class="navbar navbar-inverse" id="navbar-fix"> <div class="navbar-inner"> <div class="container"> <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <div class="nav-collapse collapse"> <ul class="nav"> <li class=""><a href="https://undertow.io/index.html">Home</a></li> <li class="active"><a href="https://undertow.io/blog/index.html">Blog</a></li> <li class=""><a href="https://undertow.io/downloads.html">Download</a></li> <li class=""><a href="https://undertow.io/documentation.html">Documentation</a></li> <li class=""><a href="https://undertow.io/get-involved.html">Get Involved</a></li> <li class="divider"></li> </ul> </div> </div> </div> </div> <h2 class="title">Using HTTP2 With Wildfly 9.0.0.Beta1</h2> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>The upcoming Wildfly 9.0.0.Beta1 release supports HTTP2, which includes new features like request multiplexing and server push, unfortunately due to a few different factors it is not as straightforward to set up as HTTP1. The complexity comes because HTTP2 as implemented by major browsers requires the use of TLS. This is further complicated by the fact that it does not use straight TLS, but requires a extension called ALPN (application layer protocol negotiation).</p> </div> <div class="paragraph"> <p>Support for ALPN will be coming in Java 9, however unfortunately it is not present in JDK7 or JDK8. To get around this we need to install a jar that provides ALPN support into the JVM&#8217;s boot class path. The version of the jar file that you need is tied to the JVM version in use, so you must make sure you are using the correct version for you JVM.</p> </div> <div class="paragraph"> <p>Note that you must use JDK8 to use HTTP2, as HTTP2 requires stronger cyphers than are present in JDK7.</p> </div> <div class="paragraph"> <p><strong>IMPORTANT</strong>: The script and instructions below are just using a self signed certificate that is present in the Undertow test suite to get you started. <strong>DO NOT USE THIS CERTIFICATE IN PRODUCTION.</strong> You should get a real certificate signed by a trusted certificate authority.</p> </div> </div> </div> <div class="sect1"> <h2 id="_the_tl_dr_version">The TL;DR version</h2> <div class="sectionbody"> <div class="paragraph"> <p>Make sure you are using <strong>JDK 1.8.0u40</strong>, then run the script below. This will (hopefully) perform all the steps that are required to setup Wildfly.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">#!/bin/bash&#x000A;&#x000A;if [ "x$JBOSS_HOME" == "x" ]; then&#x000A;	echo "JBOSS_HOME is not set, please set it to the root of your Wildfly installation"&#x000A;	exit&#x000A;fi&#x000A;&#x000A;cd $JBOSS_HOME&#x000A;&#x000A;#IMPORTANT: The ALPN version changes depending on the version of the JVM you are using&#x000A;#If you see class not found or similar SSL errors please look up the correct version&#x000A;# at http://eclipse.org/jetty/documentation/current/alpn-chapter.html&#x000A;ALPN_VERSION=8.1.3.v20150130&#x000A;&#x000A;#download our fake certificate for testing&#x000A;#DO NOT USE THIS IN PRODUCTION&#x000A;#Get a real cert instead&#x000A;curl https://raw.githubusercontent.com/undertow-io/undertow/master/core/src/test/resources/server.keystore &gt;standalone/configuration/server.keystore&#x000A;curl https://raw.githubusercontent.com/undertow-io/undertow/master/core/src/test/resources/server.truststore &gt;standalone/configuration/server.truststore&#x000A;&#x000A;#Download the ALPN jar we are interested in&#x000A;curl http://central.maven.org/maven2/org/mortbay/jetty/alpn/alpn-boot/$ALPN_VERSION/alpn-boot-$ALPN_VERSION.jar &gt;bin/alpn-boot-$ALPN_VERSION.jar&#x000A;&#x000A;#Add ALPN to the boot class path&#x000A;echo 'JAVA_OPTS="$JAVA_OPTS' " -Xbootclasspath/p:$JBOSS_HOME/bin/alpn-boot-$ALPN_VERSION.jar" '"' &gt;&gt;bin/standalone.conf&#x000A;&#x000A;#Start Wildfly in the background&#x000A;./bin/standalone.sh &amp;&#x000A;#wait for Wildfly to start&#x000A;sleep 15&#x000A;&#x000A;#Add a HTTPS connector&#x000A;./bin/jboss-cli.sh -c "--command=/core-service=management/security-realm=https:add()"&#x000A;./bin/jboss-cli.sh -c "--command=/core-service=management/security-realm=https/authentication=truststore:add(keystore-path=server.truststore, keystore-password=password, keystore-relative-to=jboss.server.config.dir)"&#x000A;./bin/jboss-cli.sh -c "--command=/core-service=management/security-realm=https/server-identity=ssl:add(keystore-path=server.keystore, keystore-password=password, keystore-relative-to=jboss.server.config.dir)"&#x000A;./bin/jboss-cli.sh -c "--command=/subsystem=undertow/server=default-server/https-listener=https:add(socket-binding=https, security-realm=https, enable-http2=true)"&#x000A;&#x000A;#shut down Wildfly&#x000A;kill `jps | grep jboss-modules.jar | cut -f1 -d ' ' `</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_a_step_by_step_guide">A step by step guide</h2> <div class="sectionbody"> <div class="dlist"> <dl> <dt class="hdlist1">Figure out the correct Jetty ALPN Jar for your JDK version</dt> <dd> <p>Have a look at <a href="http://eclipse.org/jetty/documentation/current/alpn-chapter.html" class="bare">http://eclipse.org/jetty/documentation/current/alpn-chapter.html</a> to figure out which version of Jetty ALPN is required for your JVM version. Download the correct jar version from <a href="http://central.maven.org/maven2/org/mortbay/jetty/alpn/alpn-boot/">maven central</a> and place it in the Wildfly bin directory.</p> </dd> <dt class="hdlist1">Add ALPN to the boot class path</dt> <dd> <p>Edit standalone.conf and add the following line to the JAVA_OPTS environment variable (making appropriate substitutions for the ALPN version). <code>-Xbootclasspath/p:$JBOSS_HOME/bin/alpn-boot-$ALPN_VERSION.jar</code></p> </dd> <dt class="hdlist1">Get a SSL certificate and create a keystore and truststore</dt> <dd> <p>For testing purposes you can download the ones from the Undertow test suite that are linked in the script above. For production use you will need to create a certificate and get it signed by a certificate authority. For the purposes of these instructions we assume they are located in standalone/configuration/server.[keystore|truststore].</p> </dd> <dt class="hdlist1">Start Wildfly</dt> <dd> <p>We are going to make the remaining changes using the CLI, which means Wildfly must be started.</p> </dd> <dt class="hdlist1">Connect to Wildfly using the CLI</dt> <dd> <p>Run the following command to connect: <code>$JBOSS_HOME/bin/jboss-cli.sh -c</code>.</p> </dd> <dt class="hdlist1">Add a security realm</dt> <dd> <p>This contains the configuration that is used to tell the HTTPS connector which certificates to use.</p> </dd> </dl> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code>/core-service=management/security-realm=https:add()&#x000A;/core-service=management/security-realm=https/authentication=truststore:add(keystore-path=server.truststore, keystore-password=password, keystore-relative-to=jboss.server.config.dir)&#x000A;/core-service=management/security-realm=https/server-identity=ssl:add(keystore-path=server.keystore, keystore-password=password, keystore-relative-to=jboss.server.config.dir)</code></pre> </div> </div> <div class="dlist"> <dl> <dt class="hdlist1">Add a HTTPS connector</dt> </dl> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code>/subsystem=undertow/server=default-server/https-listener=https:add(socket-binding=https, security-realm=https, enable-http2=true)</code></pre> </div> </div> <div class="dlist"> <dl> <dt class="hdlist1">Test it out</dt> <dd> <p>Fire up Chrome and head to <a href="https://localhost:8443">https://localhost:8443</a>. After clicking through the security warning about the self signed certificate you should see the normal Wildfly welcome page. Open up the developer tools and have a look in the <em>Network</em> tab. In the request headers section you should see chrome sending HTTP2 pseudo headers (:path, :authority, :method and :scheme). You can also look in the <code>chrome://net-internals</code> page, and you should be able to see the details of the HTTP2 session (although it will show up as a SPDY_SESSION event, as internally Chrome has been referring to HTTP2 as SPDY4).</p> </dd> </dl> </div> </div> </div> <div id="companyfooter-placeholder"></div> </div> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="https://www.redhat.com/"><img src="https://static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <script src="https://static.jboss.org/wildfly/scripts/bootstrap-community.min.js"></script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61374382-1', 'auto');
  ga('send', 'pageview');
</script> </body> </html>